package com.ggp.utils.recall;

import com.ggp.*;
import com.ggp.players.deepstack.utils.Strategy;
import sun.reflect.generics.reflectiveObjects.NotImplementedException;

public class ImperfectRecallExploitability {
    public static double computeExploitability(IStrategy normalizedStratForBothPlayers, IGameDescription gameDescription) {
        return computeExploitability(normalizedStratForBothPlayers, gameDescription.getInitialState(), null);
    }

    public static double computeExploitability(IStrategy normalizedStratForBothPlayers, IGameDescription gameDescription, Strategy outBestResponseStrategy) {
        return computeExploitability(normalizedStratForBothPlayers, gameDescription.getInitialState(), outBestResponseStrategy);
    }

    public static double computeExploitability(IStrategy normalizedStratForBothPlayers, ICompleteInformationState initialState) {
        return computeExploitability(normalizedStratForBothPlayers, initialState, null);
    }

    /**
     * Computes exploitability and best response strategy
     * @param normalizedStratForBothPlayers
     * @param initialState
     * @param outBestResponseStrategy strategy into which best response will be written (strategy will be for perfect-recall wrapper of the orginal game)
     * @return
     */
    public static double computeExploitability(IStrategy normalizedStratForBothPlayers, ICompleteInformationState initialState, Strategy outBestResponseStrategy) {
        IStrategy perfRecallStrategy = new IStrategy() {
            private IInformationSet getOrigInfoSet(IInformationSet is) {
                PerfectRecallIS pris = (PerfectRecallIS) is;
                return pris.getOrigInfoSet();
            }

            @Override
            public double getProbability(IInformationSet s, IAction a) {
                return normalizedStratForBothPlayers.getProbability(getOrigInfoSet(s), a);
            }

            @Override
            public Iterable<IInformationSet> getDefinedInformationSets() {
                throw new NotImplementedException();
            }
        };
        return PerfectRecallExploitability.computeExploitability(perfRecallStrategy, PerfectRecallGameDescriptionWrapper.wrapInitialState(initialState), outBestResponseStrategy);
    }
}
