package com.ggp.utils.recall;

import com.ggp.IAction;
import com.ggp.ICompleteInformationState;
import com.ggp.IInformationSet;
import com.ggp.IStrategy;
import com.ggp.games.LeducPoker.GameDescription;
import com.ggp.games.LeducPoker.InformationSet;
import com.ggp.games.LeducPoker.Rounds;
import com.ggp.games.LeducPoker.actions.CallAction;
import com.ggp.games.LeducPoker.actions.FoldAction;
import com.ggp.games.LeducPoker.actions.RaiseAction;
import org.junit.jupiter.api.Test;
import sun.reflect.generics.reflectiveObjects.NotImplementedException;

import static org.junit.jupiter.api.Assertions.*;

class ImperfectRecallExploitabilityTest {
    @Test
    void testLeduc_alwaysFold() {
        ICompleteInformationState initialState = new GameDescription(7,7).getInitialState();
        IStrategy alwaysFold = new IStrategy() {
            @Override
            public double getProbability(IInformationSet s, IAction a) {
                if (a.getClass() == FoldAction.class) return 1;
                return 0;
            }

            @Override
            public IAction sampleAction(IInformationSet s) {
                throw new NotImplementedException();
            }

            @Override
            public Iterable<IInformationSet> getDefinedInformationSets() {
                throw new NotImplementedException();
            }
        };

        // always fold strategy will lose 1 chip per game (initial bet)
        assertEquals(1, ImperfectRecallExploitability.computeExploitability(alwaysFold, initialState));
    }

    @Test
    void testLeduc_raiseThenFold() {
        ICompleteInformationState initialState = new GameDescription(7,7).getInitialState();
        IStrategy alwaysFold = new IStrategy() {
            @Override
            public double getProbability(IInformationSet s, IAction a) {
                InformationSet is = (InformationSet) s;
                if (is.getRound() == Rounds.Bet2) {
                    if (a.getClass() == FoldAction.class) return 1;
                } else {
                    if (is.wasRaised() && a.getClass() == CallAction.class) return 1;
                    if (!is.wasRaised() && a.getClass() == RaiseAction.class) return 1;
                }
                return 0;
            }

            @Override
            public IAction sampleAction(IInformationSet s) {
                throw new NotImplementedException();
            }

            @Override
            public Iterable<IInformationSet> getDefinedInformationSets() {
                throw new NotImplementedException();
            }
        };

        // always fold strategy will lose 3 chips
        assertEquals(3, ImperfectRecallExploitability.computeExploitability(alwaysFold, initialState));
    }

}